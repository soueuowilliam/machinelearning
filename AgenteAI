from langchain_openai import ChatOpenAI
from langchain_huggingface import HuggingFaceEndpoint, ChatHuggingFace
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser, JsonOutputParser
from pydantic import Field, BaseModel
from dotenv import load_dotenv
import os

os.environ['HUGGINGFACEHUB_API_TOKEN'] = 'hf_xxx'

class Cidades(BaseModel):
    cidade:str = Field('Uma cidade no Brasil para viajar e conhecer')
    motivo:str = Field('O motivo é levar minha família.')

parseador = JsonOutputParser(pydantic_object = Cidades)    
prompt = PromptTemplate( template = 'Sugira uma cidade dado o meu interesse por {interesse}, onde tenha hoteis próximos.\n {saida}',
                        input_variables = ['interesse'],
                        partial_variables = {'saida':parseador.get_format_instructions()})

llm = HuggingFaceEndpoint( model = 'HuggingFaceH4/zephyr-7b-beta', temperature = 0.5, max_new_tokens = 512)
chat = ChatHuggingFace(llm = llm )

cadeia = prompt | chat | parseador

resposta = cadeia.invoke({'interesse':'frio'})
print(resposta)
