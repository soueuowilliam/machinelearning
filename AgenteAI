#LANGCHAIN IMPORTS
from langchain_core.chat_history import InMemoryChatMessageHistory
from langchain_community.vectorstores import Chroma
from langchain_google_genai import ChatGoogleGenerativeAI, GoogleGenerativeAIEmbeddings
from langchain_core.documents import Document
from langchain_core.prompts import ChatPromptTemplate, PromptTemplate
from langchain_core.output_parsers import StrOutputParser, JsonOutputParser
from langchain_core.globals import set_debug

#set_debug(True)

#IMPORT SYSTEM
import os
from dotenv import load_dotenv
from pydantic import Field, BaseModel

#API KEY GOOGLE GEMINI
key = os.getenv['GOOGLE_API_KEY']

#MODELO DE INTELIGÊNCIA ARTIFICAL
llm = ChatGoogleGenerativeAI(model = 'gemini-2.5-flash', temperature = 0.5, api_key = key)

#INSTRUÇÕES PARA A LLM
class Destino(BaseModel):
    cidade:str = Field('A cidade recomendada para visitar')
    motivo:str = Field('O motivo é uma viagem com a familia')

class Restaurante(BaseModel):
    cidade:str = Field('A cidade recomendada para visitar')
    restaurante:str = Field('Restaurantes recomendados na cidade')

txt_cidade = 'Sugira uma cidade dado o meu interesse por {interesse}.\n {saida}'
parseador_cidade = JsonOutputParser(pydantic_object = Destino)
template_cidade = PromptTemplate(template = txt_cidade, input_variables = ['interesse'], partial_variables = {'saida':parseador_cidade.get_format_instructions()})

txt_restaurante = 'Sugira restaurantes populares entre locais em {cidade}.\n {saida}'
parseador_restaurante = JsonOutputParser(pydantic_object = Restaurante)
template_restaurante = PromptTemplate(template = txt_restaurante, partial_variables = {'saida':parseador_restaurante.get_format_instructions()})

txt_cultural = 'Sugira atividades e locais culturais em {cidade}'
template_cultural = PromptTemplate(template = txt_cultural)

#CADEIA DE SEQUENCIA
chain_cidade = template_cidade | llm | parseador_cidade
chain_restaurante = template_restaurante | llm | parseador_restaurante
chain_cultural = template_cultural | llm | StrOutputParser()

#CADEIA PRINCIPAL
chain = (chain_cidade | chain_restaurante | chain_cultural)

#RESULTADO DA PERGUNTA
resposta = chain.invoke({'interesse' : 'praias'})
print(resposta)

